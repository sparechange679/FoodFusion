<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FoodFusion | Home</title>
    <!-- Favicon -->
    <link
      rel="shortcut icon"
      href="assets/img/logos/favicon.svg"
      type="image/x-icon"
    />
    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="assets/css/font-awesome/css/all.css" />
    <link rel="stylesheet" href="assets/css/font-awesome/css/all.min.css" />
    <!-- Hover CSS -->
    <link rel="stylesheet" href="assets/css/hover-min.css" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>

  <body>
    <!-- Navigation Section Start -->
    <header class="navbar">
      <nav id="site-top-nav" class="navbar-menu navbar-fixed-top">
        <div class="container">
          <!-- logo -->
          <div class="logo">
            <a href="http://localhost:8000/" title="Logo">
              <h1 class="img-responsive mt-10">FoodFusion</h1>
            </a>
          </div>
          <!-- Main Menu -->
          <div class="menu text-right">
            <ul>
              <li>
                <a
                  class="hvr-underline-from-center active"
                  href="http://localhost:8000/"
                  >Home</a
                >
              </li>
              <li>
                <a class="hvr-underline-from-center" href="/about">About</a>
              </li>
              <li>
                <a class="hvr-underline-from-center" href="/recipe">Recipe</a>
              </li>
              <li>
                <a class="hvr-underline-from-center" href="/cookbook"
                  >Cookbook</a
                >
              </li>
              <li>
                <a class="hvr-underline-from-center" href="/contact">Contact</a>
              </li>
              <li>
                <a class="hvr-underline-from-center" href="/culinary"
                  >Culinary</a
                >
              </li>
              <li>
                <a class="hvr-underline-from-center" href="/educational"
                  >Educational</a
                >
              </li>
              <li id="button-cart">
                <a id="shopping-cart" class="shopping-cart">
                  <i class="fa fas fa-sign-in-alt"></i>
                </a>
                <div id="cart-content" class="cart-content">
                  <h3 class="text-center" id="form-title">Join Us</h3>
                  <form action="" class="form-join">
                    <fieldset>
                      <!-- value: 1 => login/sign-in, value: 0 => join/sign-up -->
                      <input
                        type="hidden"
                        name="form-value"
                        id="form-value"
                        value="0"
                      />

                      <label class="label" for="firstname" id="firstname-label"
                        >Firstname</label
                      >
                      <input
                        type="text"
                        id="firstname"
                        placeholder="Enter your firstname..."
                        required
                      />

                      <label class="label" for="lastname" id="lastname-label"
                        >Lastname</label
                      >
                      <input
                        type="text"
                        id="lastname"
                        placeholder="Enter your lastname..."
                        required
                      />

                      <label class="label" for="email">Email</label>
                      <input
                        type="email"
                        id="email"
                        placeholder="Enter your email..."
                        required
                      />

                      <label class="label" for="password">Password</label>
                      <input
                        type="password"
                        id="password"
                        placeholder="Enter your password..."
                        required
                      />

                      <input
                        type="submit"
                        value="Join Now"
                        id="login-btn"
                        class="btn-primary"
                      />
                      <a href="#" class="ml-20" id="sign-btn">Sign in</a>
                    </fieldset>
                  </form>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <!-- Navigation Section End -->

    <!-- Food Search Section Start -->
    <section class="food-search text-center">
      <div class="container">
        <form action="food-search.html">
          <input type="search" placeholder="Search for food..." required />
          <input type="submit" value="Search" class="btn-primary" />
        </form>
      </div>
    </section>
    <!-- Food Search Section End -->

    <!-- Category Section Start -->
    <section class="categories">
      <div class="container">
        <h2 class="text-center">Explore Foods</h2>
        <div class="heading-border"></div>

        <div class="grid-3">
          <a href="category-foods.html">
            <div class="float-container">
              <img
                src="assets/img/category/pizza.jpg"
                class="img-responsive"
                alt=""
              />
              <h3 class="float-text text-white">Pizza</h3>
            </div>
          </a>
          <a href="category-foods.html">
            <div class="float-container">
              <img
                src="assets/img/category/sandwich.jpg"
                class="img-responsive"
                alt=""
              />
              <h3 class="float-text text-white">Sandwich</h3>
            </div>
          </a>
          <a href="category-foods.html">
            <div class="float-container">
              <img
                src="assets/img/category/burger.jpg"
                class="img-responsive"
                alt=""
              />
              <h3 class="float-text text-white">Burger</h3>
            </div>
          </a>
        </div>
      </div>
    </section>
    <!-- Category Section End -->

    <!-- Foods Section Start -->
    <section class="food-menu">
      <div class="container">
        <h2 class="text-center">Recipe Collection</h2>
        <div class="heading-border"></div>
        <div class="grid-2">
          <!-- Recipes will be dynamically appended here (max 4) -->
        </div>
      </div>
      <p class="text-center">
        <a href="/recipe" class="btn-primary">See All Foods</a>
      </p>
    </section>
    <!-- Foods Section End -->

    <!-- Footer Section Start -->
    <section class="footer">
      <div class="container">
        <div class="grid-3">
          <div class="text-center">
            <h3>About Us</h3>
            <br />
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Placeat
              officia, temporibus expedita dicta eligendi harum architecto
              fugiat sint, laudantium omnis animi. Voluptas praesentium maiores
              minima pariatur necessitatibus consequuntur, similique assumenda.
            </p>
          </div>
          <div class="texr-center">
            <h3>Site Map</h3>
            <br />
            <div class="site-links">
              <a href="http://localhost:8000/">Home</a>
              <a href="/about">About</a>
              <a href="/recipe">Recipe</a>
              <a href="/cookbook">Cookbook</a>
              <a href="/contact">Contact</a>
              <a href="/culinary">Culinary</a>
              <a href="/educational">Educational</a>
            </div>
          </div>
          <div class="social-links">
            <h3>Social Links</h3>
            <br />
            <div class="social">
              <ul>
                <li>
                  <a href="https://facebook.com/"
                    ><img src="assets/img/logos/facebook-logo.svg"
                  /></a>
                </li>
                <li>
                  <a href="https://instagram.com/"
                    ><img src="assets/img/logos/instagram-logo.svg"
                  /></a>
                </li>
                <li>
                  <a href="https://x.com/"
                    ><img src="assets/img/logos/x-logo.svg"
                  /></a>
                </li>
                <li>
                  <a href="https://linkedin.com/"
                    ><img src="assets/img/logos/linkedin-logo.svg"
                  /></a>
                </li>
                <li>
                  <a href="https://youtube.com/"
                    ><img src="assets/img/logos/youtube-logo.svg"
                  /></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Footer Section End -->

    <!-- Copyright Section start -->
    <section class="copyright">
      <div class="container text-center">
        <p>All rights reserved. Design By <a href="#">Farai Mzumara</a></p>
      </div>
      <a id="back-to-top" class="btn-primary">
        <i class="fa fa-angle-double-up"></i>
      </a>
    </section>
    <!-- Copyright Section End -->

    <!-- JQuery -->
    <script src="assets/js/jquery/jquery-3.6.0.js.js"></script>
    <!-- Jquery UI -->
    <script src="assets/js/jquery/jquery-ui.js.js"></script>
    <!-- Custom JS -->
    <script src="assets/js/custom.js"></script>
    <script src="assets/js/font-awesome/all.js"></script>
    <script src="assets/js/font-awesome/all.min.js"></script>

    <script>
      $(document).ready(function () {
        const formTitle = $("#form-title");
        const formValue = $("#form-value");
        const firstname = $("#firstname");
        const lastname = $("#lastname");
        const firstnameLabel = $("#firstname-label");
        const lastnameLabel = $("#lastname-label");
        const email = $("#email");
        const password = $("#password");
        const loginBtn = $("#login-btn");
        const signBtn = $("#sign-btn");
        const shoppingCart = $("#button-cart"); // The shopping cart button
        const cartContent = $("#cart-content");
        const endpoints = {
          signUp: "http://localhost:8000/foodfusion/auth/sign-up",
          signIn: "http://localhost:8000/foodfusion/auth/sign-in",
        };

        // Check if user is logged in
        const token = localStorage.getItem("authToken");
        if (token) {
          const user = JSON.parse(localStorage.getItem("authUser"));
          updateUIForLoggedInUser(user);
        }

        // Toggle between Sign Up and Sign In forms
        signBtn.on("click", function () {
          if (formValue.val() == 0) {
            formValue.val("1");
            firstname.fadeOut();
            firstnameLabel.fadeOut();
            lastname.fadeOut();
            lastnameLabel.fadeOut();
            formTitle.html("Sign In");
            loginBtn.val("Login");
            signBtn.html("Sign up");
          } else {
            formValue.val("0");
            firstname.fadeIn();
            firstnameLabel.fadeIn();
            lastname.fadeIn();
            lastnameLabel.fadeIn();
            formTitle.html("Join Us");
            loginBtn.val("Join Now");
            signBtn.html("Sign in");
          }
        });

        // Handle form submission
        loginBtn.on("click", function (e) {
          e.preventDefault();

          const isSignUp = formValue.val() == "0";
          const endpoint = isSignUp ? endpoints.signUp : endpoints.signIn;

          // Gather form data
          const data = {
            email: email.val(),
            password: password.val(),
          };

          if (isSignUp) {
            data.firstname = firstname.val();
            data.lastname = lastname.val();
          }

          // AJAX request
          $.ajax({
            url: endpoint,
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function (response) {
              // Save token and user data in localStorage
              localStorage.setItem("authToken", response.data.token);
              localStorage.setItem(
                "authUser",
                JSON.stringify(response.data.user)
              );
              updateUIForLoggedInUser(response.data.user);
              cartContent.hide(); // Hide the form after login or registration
            },
            error: function (xhr) {
              alert(
                xhr.responseJSON?.message ||
                  "An error occurred. Please try again."
              );
            },
          });
        });

        // Handle logout
        $(document).on("click", "#logout-btn", function () {
          localStorage.removeItem("authToken");
          localStorage.removeItem("authUser");
          resetUIToLoggedOutState();
        });

        // Update UI for logged-in user
        function updateUIForLoggedInUser(user) {
          shoppingCart.html(`
      <span>Welcome, ${user.firstname}</span>
      <button id="logout-btn" class="btn-primary">
        <i class="fa fas fa-sign-out-alt"></i> Logout
      </button>
    `);
        }

        // Reset UI to logged-out state
        function resetUIToLoggedOutState() {
          shoppingCart.html(`
            <a id="shopping-cart" class="shopping-cart">
                  <i class="fa fas fa-sign-in-alt"></i>
                </a>
                <div id="cart-content" class="cart-content">
                  <h3 class="text-center" id="form-title">Join Us</h3>
                  <form action="" class="form-join">
                    <fieldset>
                      <!-- value: 1 => login/sign-in, value: 0 => join/sign-up -->
                      <input
                        type="hidden"
                        name="form-value"
                        id="form-value"
                        value="0"
                      />

                      <label class="label" for="firstname" id="firstname-label"
                        >Firstname</label
                      >
                      <input
                        type="text"
                        id="firstname"
                        placeholder="Enter your firstname..."
                        required
                      />

                      <label class="label" for="lastname" id="lastname-label"
                        >Lastname</label
                      >
                      <input
                        type="text"
                        id="lastname"
                        placeholder="Enter your lastname..."
                        required
                      />

                      <label class="label" for="email">Email</label>
                      <input
                        type="email"
                        id="email"
                        placeholder="Enter your email..."
                        required
                      />

                      <label class="label" for="password">Password</label>
                      <input
                        type="password"
                        id="password"
                        placeholder="Enter your password..."
                        required
                      />

                      <input
                        type="submit"
                        value="Join Now"
                        id="login-btn"
                        class="btn-primary"
                      />
                      <a href="#" class="ml-20" id="sign-btn">Sign in</a>
                    </fieldset>
                  </form>
                </div>
    `);
          cartContent.show(); // Show the form again
        }
      });
    </script>
    <script>
      $(document).ready(function () {
        const recipesEndpoint = "http://localhost:8000/foodfusion/recipes";

        // Fetch recipes from the API
        $.ajax({
          url: recipesEndpoint,
          type: "GET",
          success: function (response) {
            if (response.success) {
              const recipes = response.data.allRecipes.slice(0, 4); // Select the first 4 recipes
              const recipesContainer = $(".grid-2");

              // Clear existing content
              recipesContainer.empty();

              // Loop through the first 4 recipes and populate the page
              recipes.forEach((recipe) => {
                const recipeHtml = `
                    <div class="food-menu-box">
                      <form action="">
                        <div class="food-menu-img">
                          <img
                            src="${recipe.pictureUrl}"
                            alt="${recipe.title}"
                            class="img-responsive img-curve"
                          />
                        </div>
                        <div class="food-menu-desc">
                          <h4>${recipe.title}</h4>
                          <p class="food-details">
                            ${recipe.instructions}
                          </p>
                          ${recipe.ingredients
                            .split(", ")
                            .map(
                              (ingredient) => `<a href="#">${ingredient}</a>`
                            )
                            .join(" &nbsp; ")}
                        </div>
                      </form>
                    </div>
                  `;

                recipesContainer.append(recipeHtml);
              });
            } else {
              alert("Failed to load recipes. Please try again later.");
            }
          },
          error: function (xhr) {
            alert(
              "An error occurred while fetching the recipes. Please try again later."
            );
          },
        });
      });
    </script>
  </body>
</html>
